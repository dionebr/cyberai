from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
from src.api.core.ollama_client import OllamaClient

router = APIRouter()

class ExploitRequest(BaseModel):
	cve: str = ""
	vulnerability_type: str = ""
	target_os: str = ""
	target_app: str = ""
	constraints: dict = {}

@router.post("/exploit")
async def generate_exploit(request: ExploitRequest):
	ollama = OllamaClient()
	exploit_prompt = f"Gere um exploit completo para: CVE: {request.cve} Tipo: {request.vulnerability_type} SO: {request.target_os} App: {request.target_app} Restrições: {request.constraints}"
	try:
		result = ollama.generate("cyberhack", exploit_prompt, options={"temperature":0.7, "top_p":0.9, "num_predict":4096})
		return {"exploit_code": result["response"]}
	except Exception as e:
		raise HTTPException(status_code=500, detail=str(e))
